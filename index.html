<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- ä½ çš„ head éƒ¨åˆ†å®Œå…¨ä¸è®Š -->
    <style>
        /* æ–°å¢æ–‡å­—é€²å ´å‹•ç•« */
        #text-container {
            position: absolute;
            z-index: 2;
            top: 50%;
            left: 50%;                   /* å…ˆå¾ä¸­é–“é–‹å§‹ */
            transform: translate(-50%, -50%);
            color: #fff;
            text-align: center;          /* æ”¹æˆç½®ä¸­ï¼Œçœ‹èµ·ä¾†æ›´å¹³è¡¡ */
            pointer-events: none;
            opacity: 0;
            transition: opacity 2.5s ease-out, transform 2.5s ease-out;
            max-width: 500px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .title {
            font-family: 'Great Vibes', cursive;
            font-size: 5rem;             /* ç¨å¾®æ”¾å¤§ä¸€é» */
            color: #FF69B4;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.9);
        }

        .message {
            font-size: 1.3rem;
            line-height: 1.9;
        }

        /* æ–‡å­—æœ€çµ‚å‡ºç¾çš„ç‹€æ…‹ */
        .show-text {
            opacity: 1 !important;
            transform: translate(-150%, -50%) !important;  /* ç§»å‹•åˆ°å·¦å´ */
        }
    </style>
</head>
<body>
    <!-- ä½ çš„æ–‡å­—å€å¡Šä¸è®Š -->
    <div id="text-container">
        <div class="title">Happy Birthday</div>
        <div class="message">
            Hey You,<br>
            Happy Birthday! <span style="color:#ff69b4">ğŸˆ</span><br>
            May God bless you <span style="color:#00ffff">ğŸ€</span><br>
            And give you many happiness.<br>
            Just saying... you're pretty awesome <span style="color:#ff4500">â¤ï¸</span><br>
            Sending good vibes and maybe a wink ğŸ˜‰<br>
            Hope you have a great day today! <span style="color:#ff1493">ğŸ’•</span>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const colors = ['#FF69B4', '#FFB6C1', '#FFD700', '#FFA500', '#FF4500', '#DA70D6', '#FFC0CB', '#FF1493', '#FF69B4'];

        const config = {
            trunkColor: '#FFB6C1',
            growSpeed: 15,               // ç¨å¾®åŠ å¿«ä¸€é»
            leafSize: 14,
            lengthRatio: 0.82,
            widthRatio: 0.68
        };

        let animatingTasks = 0;
        let isTreeDone = false;
        let fallingLeaves = [];
        let treeImage = null;
        let treeOffsetX = 0;             // æ–°å¢ï¼šæ¨¹çš„æ°´å¹³ä½ç§»
        let targetOffsetX = 0;           // ç›®æ¨™ä½ç§»

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            drawAll();                       // é‡ç¹ªæ™‚è€ƒæ…®ä½ç§»
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // ... getRandomColor, drawHeart, drawLeafCluster å®Œå…¨ä¸è®Š ...

        function drawAll() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (treeImage) {
                ctx.drawImage(treeImage, treeOffsetX, 0);
            }
            // è½è‘‰ä¹Ÿè·Ÿè‘—æ¨¹ç§»å‹•
            fallingLeaves.forEach(leaf => {
                leaf.x += (targetOffsetX - treeOffsetX) * 0.02; // è¼•å¾®è·Ÿéš¨ï¼ˆå¯é¸ï¼‰
            });
        }

        function finishGrowth() {
            isTreeDone = true;
            
            // å…ˆå­˜ä¸‹ã€Œä¸­é–“ä½ç½®ã€çš„æ¨¹åœ–
            const img = new Image();
            img.src = canvas.toDataURL();
            img.onload = () => {
                treeImage = img;

                // é–‹å§‹ç§»å‹•æ¨¹åˆ°å³å´ + é¡¯ç¤ºæ–‡å­—
                targetOffsetX = canvas.width * 0.35;  // æœ€çµ‚æ¨¹ä¸­å¿ƒåå³ï¼ˆç´„ç§»å‹•åˆ° 70% ä½ç½®ï¼‰
                
                // æ–‡å­—æ·¡å…¥ä¸¦å·¦ç§»
                const textContainer = document.getElementById('text-container');
                textContainer.classList.add('show-text');

                // å•Ÿå‹•è½è‘‰
                animateFallingLeaves();

                // å¹³æ»‘ç§»å‹•æ¨¹
                function moveTree() {
                    if (Math.abs(treeOffsetX - targetOffsetX) > 1) {
                        treeOffsetX += (targetOffsetX - treeOffsetX) * 0.08;  // ç·©å‹•
                        drawAll();
                        requestAnimationFrame(moveTree);
                    } else {
                        treeOffsetX = targetOffsetX;
                        drawAll();
                    }
                }
                moveTree();
            };
        }

        // --- æ„›å¿ƒå½¢ç‹€æ›´åœ“æ½¤çš„èª¿æ•´ ---
        function drawBranch(x, y, len, angle, width, depth, side) {
            animatingTasks++;

            setTimeout(() => {
                ctx.beginPath();
                ctx.moveTo(x, y);
                const endX = x + len * Math.cos(angle);
                const endY = y + len * Math.sin(angle);
                
                ctx.strokeStyle = config.trunkColor;
                ctx.lineWidth = width;
                ctx.lineCap = 'round';
                ctx.lineTo(endX, endY);
                ctx.stroke();

                // è‘‰å­å¡«å……
                if (depth > 0 && Math.random() < 0.95) {
                    const t = Math.random();
                    const midX = x + (endX - x) * t;
                    const midY = y + (endY - y) * t;
                    drawLeafCluster(midX, midY, 4 + depth, config.leafSize * 0.95);
                }

                if (len < 12 || width < 1.8) {
                    drawLeafCluster(endX, endY, 8, config.leafSize);
                    animatingTasks--;
                    if (animatingTasks === 0) finishGrowth();
                    return;
                }

                // æ„›å¿ƒè¼ªå»“æ›´åœ“çš„èª¿æ•´
                const baseSpread = 0.4;
                const inwardCurve = depth * 0.07;

                let leftAdjust = -baseSpread;
                let rightAdjust = baseSpread;

                if (depth > 0) {
                    // å¤–å±¤ææ¢å¾€å…§å½ï¼Œå½¢æˆæ„›å¿ƒå¼§åº¦
                    if (side === -1) leftAdjust += inwardCurve;   // å·¦å´å¾€å…§
                    if (side === 1) rightAdjust -= inwardCurve;   // å³å´å¾€å…§
                }

                // å°éš¨æ©Ÿè®“æ¨¹æ›´è‡ªç„¶
                leftAdjust += (Math.random() - 0.5) * 0.15;
                rightAdjust += (Math.random() - 0.5) * 0.15;

                const nextSideLeft = side === 0 ? -1 : side;
                const nextSideRight = side === 0 ? 1 : side;

                drawBranch(endX, endY, len * config.lengthRatio, angle + leftAdjust, width * config.widthRatio, depth + 1, nextSideLeft);
                drawBranch(endX, endY, len * config.lengthRatio, angle + rightAdjust, width * config.widthRatio, depth + 1, nextSideRight);

                animatingTasks--;
            }, config.growSpeed);
        }

        class Leaf {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -30;
                this.size = 9 + Math.random() * 9;
                this.speed = 1.2 + Math.random() * 1.8;
                this.angle = Math.random() * Math.PI * 2;
                this.spin = (Math.random() - 0.5) * 0.12;
                this.color = getRandomColor();
                this.wind = (Math.random() - 0.5) * 0.8;  // è¼•å¾®å·¦å³é£„
            }
            update() {
                this.y += this.speed;
                this.x += this.wind;
                this.angle += this.spin;
                return this.y < canvas.height + 30;
            }
            draw() {
                drawHeart(this.x + treeOffsetX, this.y, this.size, this.angle, this.color);  // è·Ÿéš¨æ¨¹ç§»å‹•
            }
        }

        function animateFallingLeaves() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (treeImage) ctx.drawImage(treeImage, treeOffsetX, 0);

            if (Math.random() < 0.2) fallingLeaves.push(new Leaf());

            fallingLeaves = fallingLeaves.filter(leaf => {
                leaf.update();
                leaf.draw();
                return leaf.update();  // å†å‘¼å«ä¸€æ¬¡ç¢ºä¿å›å‚³æ­£ç¢º
            });

            requestAnimationFrame(animateFallingLeaves);
        }

        // å•Ÿå‹•ï¼šå¾ç•«é¢æ­£ä¸­å¤®é–‹å§‹ç”Ÿé•·
        const startX = canvas.width / 2;
        const startY = canvas.height + 20;
        drawBranch(startX, startY, 150, -Math.PI / 2, 26, 0, 0);
    </script>
</body>
</html>
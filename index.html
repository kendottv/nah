<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #111; /* èƒŒæ™¯ç¨å¾®èª¿äº®ä¸€é»é»ï¼Œæ²’é‚£éº¼æ­»é»‘ï¼Œæ¯”è¼ƒåƒç¹ªæœ¬ */
            overflow: hidden;
            display: flex;
            height: 100vh;
            font-family: 'Noto Sans TC', sans-serif;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            /* å¢åŠ ä¸€é»æŸ”ç„¦æ•ˆæœï¼Œè®“ç¹ªæœ¬æ„Ÿæ›´é‡ */
            filter: contrast(1.2) brightness(1.1) blur(0.5px);
        }

        #text-container {
            position: absolute;
            z-index: 2;
            top: 50%;
            left: 8%;
            transform: translateY(-50%);
            color: #fff;
            text-align: left;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease-in;
            max-width: 450px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .title {
            font-family: 'Great Vibes', cursive;
            font-size: 4.5rem;
            color: #FF88BB; /* æ›´æŸ”å’Œçš„ç²‰è‰² */
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message {
            font-size: 1.2rem;
            line-height: 1.9;
            color: #f0f0f0;
            font-weight: 500;
        }
        
        .show-text {
            opacity: 1 !important;
        }
    </style>
</head>
<body>

    <div id="text-container">
        <div class="title">Happy Birthday</div>
        <div class="message">
            Hey You,<br>
            Happy Birthday! <span style="color:#ff69b4">ğŸˆ</span><br>
            May God bless you <span style="color:#00ffff">ğŸ€</span><br>
            And give you many happiness.<br>
            Just saying... you're pretty awesome <span style="color:#ff4500">â¤ï¸</span><br>
            Sending good vibes and maybe a wink ğŸ˜‰<br>
            Hope you have a great day today! <span style="color:#ff1493">ğŸ’•</span>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // --- ç¹ªæœ¬é¢¨é…è‰² ---
        // é¡è‰²æ›´é£½å’Œã€æº«æš–
        const leafColors = ['#FF55A3', '#FF99C8', '#FFD700', '#FF8C00', '#FF4500', '#C71585'];
        const trunkColor = '#8B4513'; // ç¶“å…¸çš„ç¹ªæœ¬æ£•è‰²

        const config = {
            growSpeedTrunk: 30,    // æ¨¹å¹¹ç”Ÿé•·é€Ÿåº¦
            bloomSpeed: 100,       // é•·è‘‰å­çš„é€Ÿåº¦ (æ³¢æ³¢æ³¢çš„é–“éš”)
            initialTrunkWidth: 40, // ã€ä¿®æ”¹é‡é»ã€‘åˆå§‹æ¨¹å¹¹è¶…ç´šç²—
            leafClusterSize: 35    // è‘‰å­åœ˜çš„å¤§å°
        };

        let animatingTasks = 0; // è¿½è¹¤æ¨¹å¹¹ä»»å‹™
        let leafSpots = [];     // å­˜æ”¾æº–å‚™é•·è‘‰å­çš„ä½ç½®
        let isTreeDone = false;
        let fallingLeaves = [];
        let treeImage = null;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (isTreeDone && treeImage) ctx.drawImage(treeImage, 0, 0);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function getRandomColor() {
            return leafColors[Math.floor(Math.random() * leafColors.length)];
        }

        // ç•«æ„›å¿ƒ (ç¶­æŒä¸è®Š)
        function drawHeart(x, y, size, angle, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.fillStyle = color;
            ctx.beginPath();
            const topCurve = size * 0.3;
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(-size / 2, -topCurve, -size, size / 3, 0, size);
            ctx.bezierCurveTo(size, size / 3, size / 2, -topCurve, 0, 0);
            ctx.fill();
            ctx.restore();
        }

        // åœ¨æŒ‡å®šä½ç½®ç•«ä¸€å¤§åœ˜è“¬é¬†çš„è‘‰å­
        function drawHugeLeafCluster(x, y) {
            const count = 8 + Math.floor(Math.random() * 5); // æ¯ä¸€åœ˜æœ‰ 8-12 ç‰‡å¤§è‘‰å­
            for(let i=0; i<count; i++) {
                // éš¨æ©Ÿåç§»é‡å¤§ä¸€é»ï¼Œè£½é€ è“¬é¬†æ„Ÿ
                const offsetX = (Math.random() - 0.5) * config.leafClusterSize * 2;
                const offsetY = (Math.random() - 0.5) * config.leafClusterSize * 2;
                const size = config.leafClusterSize * (0.8 + Math.random() * 0.7); // è‘‰å­å¾ˆå¤§
                const leafAngle = Math.random() * Math.PI * 2;
                
                ctx.shadowColor = 'rgba(0,0,0,0.3)'; // åŠ ä¸€é»é™°å½±å¢åŠ ç«‹é«”æ„Ÿ
                ctx.shadowBlur = 5;
                drawHeart(x + offsetX, y + offsetY, size, leafAngle, getRandomColor());
                ctx.shadowBlur = 0;
            }
        }

        // --- éšæ®µä¸‰ï¼šå‹•ç•«çµæŸ ---
        function finishAnimation() {
            isTreeDone = true;
            document.getElementById('text-container').classList.add('show-text');
            const img = new Image();
            img.src = canvas.toDataURL();
            img.onload = () => {
                treeImage = img;
                animateFallingLeaves();
            };
        }

        // --- éšæ®µäºŒï¼šçˆ†ç±³èŠ±é•·è‘‰å­ ---
        function startBlooming() {
            let spotIndex = 0;
            // ä½¿ç”¨ setInterval è®“è‘‰å­ä¸€åœ˜ä¸€åœ˜é•·å‡ºä¾†ï¼Œè€Œä¸æ˜¯ç¬é–“å…¨éƒ¨å‡ºç¾
            const bloomInterval = setInterval(() => {
                if (spotIndex >= leafSpots.length) {
                    clearInterval(bloomInterval);
                    // ç­‰æœ€å¾Œä¸€åœ˜é•·å®Œä¼‘æ¯ä¸€ä¸‹å†é¡¯ç¤ºæ–‡å­—
                    setTimeout(finishAnimation, 1000); 
                    return;
                }
                const spot = leafSpots[spotIndex];
                drawHugeLeafCluster(spot.x, spot.y);
                spotIndex++;
            }, config.bloomSpeed);
        }

        // --- éšæ®µä¸€ï¼šåªé•·ç²—æ¨¹å¹¹ ---
        function drawTrunk(x, y, len, angle, width) {
            animatingTasks++;

            setTimeout(() => {
                ctx.beginPath();
                ctx.moveTo(x, y);
                
                // è¨ˆç®—çµ‚é»
                const endX = x + len * Math.cos(angle);
                const endY = y + len * Math.sin(angle);
                
                // ã€ä¿®æ”¹é‡é»ã€‘ç¹ªæœ¬é¢¨æ¨¹å¹¹ï¼šç²—ã€åœ“é ­
                ctx.strokeStyle = trunkColor;
                ctx.lineWidth = width;
                ctx.lineCap = 'round'; // è®“ç·šæ¢é ­å°¾åœ“æ½¤
                ctx.lineJoin = 'round'; // è®“è½‰æŠ˜è™•åœ“æ½¤
                
                // ç¨å¾®åŠ ä¸€é»é»éš¨æ©Ÿå½æ›²ï¼Œä¸è¦å¤ªç›´
                const cpX = (x + endX) / 2 + (Math.random() - 0.5) * len * 0.1;
                const cpY = (y + endY) / 2 + (Math.random() - 0.5) * len * 0.1;
                ctx.quadraticCurveTo(cpX, cpY, endX, endY);
                // ctx.lineTo(endX, endY); // å¦‚æœå–œæ­¡ç›´ä¸€é»çš„å°±è§£é–‹é€™è¡Œï¼Œè¨»è§£ä¸Šé¢å…©è¡Œ
                ctx.stroke();

                // --- çµ‚æ­¢æ¢ä»¶ ---
                // ç•¶æ¨¹æå¤ çŸ­æˆ–å¤ ç´°ï¼Œåœæ­¢ç”Ÿé•·ï¼Œä¸¦è¨˜éŒ„é€™å€‹ä½ç½®è¦é•·è‘‰å­
                if (len < 25 || width < 8) {
                    leafSpots.push({x: endX, y: endY}); // è¨˜éŒ„ä½ç½®
                    animatingTasks--;
                    if (animatingTasks === 0) {
                        // æ¨¹å¹¹å…¨éƒ¨é•·å®Œäº†ï¼Œé€²å…¥ä¸‹ä¸€éšæ®µ
                        setTimeout(startBlooming, 500); 
                    }
                    return;
                }

                // --- ç”Ÿé•·ä¸‹ä¸€æ®µ ---
                const angleVar = 0.4 + (Math.random() - 0.5) * 0.2;
                const lenShrink = 0.8 + Math.random() * 0.1;
                const widthShrink = 0.75; // è®Šç´°çš„é€Ÿåº¦æ…¢ä¸€é»ï¼Œç¶­æŒç²—å£¯æ„Ÿ

                // åˆ†å…©å‰
                drawTrunk(endX, endY, len * lenShrink, angle + angleVar, width * widthShrink);
                drawTrunk(endX, endY, len * lenShrink, angle - angleVar, width * widthShrink);
                
                animatingTasks--;

            }, config.growSpeedTrunk);
        }

        // --- è½è‘‰å‹•ç•« (ä¿æŒä¸è®Š) ---
        class Leaf {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -50;
                this.size = 15 + Math.random() * 15; // è½è‘‰ä¹Ÿè®Šå¤§
                this.speed = 1 + Math.random() * 1.5;
                this.angle = Math.random() * 6;
                this.spin = (Math.random() - 0.5) * 0.08;
                this.color = getRandomColor();
            }
            update() {
                this.y += this.speed;
                this.angle += this.spin;
                return this.y < canvas.height + 50;
            }
            draw() {
                ctx.shadowColor = 'rgba(0,0,0,0.2)';
                ctx.shadowBlur = 5;
                drawHeart(this.x, this.y, this.size, this.angle, this.color);
                ctx.shadowBlur = 0;
            }
        }

        function animateFallingLeaves() {
            if (!isTreeDone) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (treeImage) ctx.drawImage(treeImage, 0, 0);
            if (Math.random() < 0.08) fallingLeaves.push(new Leaf());
            fallingLeaves = fallingLeaves.filter(leaf => {
                leaf.draw();
                return leaf.update();
            });
            requestAnimationFrame(animateFallingLeaves);
        }

        // --- å•Ÿå‹• ---
        // æ¨¹çš„ä½ç½®åœ¨å³å´ 75%
        const startX = canvas.width * 0.75;
        
        drawTrunk(
            startX,            // X
            canvas.height + 30, // Y (å¾ç•«é¢å¤–é•·é€²ä¾†)
            160,               // åˆå§‹é•·åº¦
            -Math.PI / 2,      // è§’åº¦
            config.initialTrunkWidth // åˆå§‹è¶…ç´šç²—åº¦
        );

    </script>
</body>
</html>
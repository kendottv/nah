<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        #text-container {
            position: absolute;
            z-index: 2;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2.5s ease-out, transform 2.5s ease-out;
            max-width: 500px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .title {
            font-family: 'Great Vibes', cursive;
            font-size: 5rem;
            color: #FF69B4;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.9);
        }

        .message {
            font-size: 1.3rem;
            line-height: 1.9;
        }

        .show-text {
            opacity: 1 !important;
            transform: translate(-150%, -50%) !important;
        }
    </style>
</head>
<body>
    <div id="text-container">
        <div class="title">Happy Birthday</div>
        <div class="message">
            Hey You,<br>
            Happy Birthday! <span style="color:#ff69b4">üéà</span><br>
            May God bless you <span style="color:#00ffff">üçÄ</span><br>
            And give you many happiness.<br>
            Just saying... you're pretty awesome <span style="color:#ff4500">‚ù§Ô∏è</span><br>
            Sending good vibes and maybe a wink üòâ<br>
            Hope you have a great day today! <span style="color:#ff1493">üíï</span>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const colors = ['#FF69B4', '#FFB6C1', '#FFD700', '#FFA500', '#FF4500', '#DA70D6', '#FFC0CB', '#FF1493', '#FF69B4'];

        const config = {
            trunkColor: '#FFB6C1',
            growSpeed: 12,
            leafSize: 15,
            lengthRatio: 0.85,
            widthRatio: 0.7,
            heartWidth: 1.4,
            heartHeight: 0.75
        };

        let animatingTasks = 0;
        let isTreeDone = false;
        let fallingLeaves = [];
        let treeImage = null;
        let treeOffsetX = 0;
        let targetOffsetX = 0;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (treeImage) drawAll();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function getRandomColor() {
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function drawHeart(x, y, size, angle, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.fillStyle = color;
            ctx.beginPath();
            const s = size / 20;
            for (let i = 0; i < Math.PI * 2; i += 0.1) {
                const hx = s * 16 * Math.pow(Math.sin(i), 3);
                const hy = -s * (13 * Math.cos(i) - 5 * Math.cos(2 * i) - 2 * Math.cos(3 * i) - Math.cos(4 * i));
                if (i === 0) ctx.moveTo(hx, hy);
                else ctx.lineTo(hx, hy);
            }
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }

        function drawLeafCluster(x, y, count, size) {
            for (let i = 0; i < count; i++) {
                const offsetX = (Math.random() - 0.5) * size * 1.5;
                const offsetY = (Math.random() - 0.5) * size * 1.5;
                const leafAngle = Math.random() * Math.PI * 2;
                const leafColor = getRandomColor();
                drawHeart(x + offsetX, y + offsetY, size, leafAngle, leafColor);
            }
        }

        function drawAll() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (treeImage) {
                ctx.drawImage(treeImage, treeOffsetX, 0);
            }
            fallingLeaves.forEach(leaf => {
                leaf.x += (targetOffsetX - treeOffsetX) * 0.02;
            });
        }

        function finishGrowth() {
            isTreeDone = true;
            
            const img = new Image();
            img.src = canvas.toDataURL();
            img.onload = () => {
                treeImage = img;

                targetOffsetX = canvas.width * 0.3;
                
                const textContainer = document.getElementById('text-container');
                textContainer.classList.add('show-text');

                animateFallingLeaves();

                function moveTree() {
                    if (Math.abs(treeOffsetX - targetOffsetX) > 1) {
                        treeOffsetX += (targetOffsetX - treeOffsetX) * 0.08;
                        drawAll();
                        requestAnimationFrame(moveTree);
                    } else {
                        treeOffsetX = targetOffsetX;
                        drawAll();
                    }
                }
                moveTree();
            };
        }

        function drawBranch(x, y, len, angle, width, depth, side) {
            animatingTasks++;

            setTimeout(() => {
                ctx.beginPath();
                ctx.moveTo(x, y);
                const endX = x + len * Math.cos(angle);
                const endY = y + len * Math.sin(angle);
                
                ctx.strokeStyle = config.trunkColor;
                ctx.lineWidth = width;
                ctx.lineCap = 'round';
                ctx.lineTo(endX, endY);
                ctx.stroke();

                if (depth > 0 && Math.random() < 0.92) {
                    const t = Math.random();
                    const midX = x + (endX - x) * t;
                    const midY = y + (endY - y) * t;
                    drawLeafCluster(midX, midY, 4 + depth, config.leafSize * 0.9);
                }

                if (len < 10 || width < 1.5) {
                    drawLeafCluster(endX, endY, 10, config.leafSize);
                    animatingTasks--;
                    if (animatingTasks === 0) finishGrowth();
                    return;
                }

                let leftAngle, rightAngle;
                
                if (depth === 0) {
                    leftAngle = angle - 0.55 * config.heartWidth;
                    rightAngle = angle + 0.55 * config.heartWidth;
                } else {
                    const spreadFactor = 0.35 * config.heartWidth;
                    const verticalSuppression = depth * 0.05 * config.heartHeight;
                    
                    leftAngle = angle - spreadFactor + verticalSuppression;
                    rightAngle = angle + spreadFactor + verticalSuppression;
                    
                    if (depth > 2) {
                        const inwardCurve = 0.08;
                        if (side === -1) leftAngle += inwardCurve;
                        if (side === 1) rightAngle -= inwardCurve;
                    }
                }

                leftAngle += (Math.random() - 0.5) * 0.12;
                rightAngle += (Math.random() - 0.5) * 0.12;

                const nextSideLeft = side === 0 ? -1 : side;
                const nextSideRight = side === 0 ? 1 : side;

                drawBranch(endX, endY, len * config.lengthRatio, leftAngle, width * config.widthRatio, depth + 1, nextSideLeft);
                drawBranch(endX, endY, len * config.lengthRatio, rightAngle, width * config.widthRatio, depth + 1, nextSideRight);

                animatingTasks--;
            }, config.growSpeed);
        }

        class Leaf {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -30;
                this.size = 9 + Math.random() * 9;
                this.speed = 1.2 + Math.random() * 1.8;
                this.angle = Math.random() * Math.PI * 2;
                this.spin = (Math.random() - 0.5) * 0.12;
                this.color = getRandomColor();
                this.wind = (Math.random() - 0.5) * 0.8;
            }
            update() {
                this.y += this.speed;
                this.x += this.wind;
                this.angle += this.spin;
                return this.y < canvas.height + 30;
            }
            draw() {
                drawHeart(this.x + treeOffsetX, this.y, this.size, this.angle, this.color);
            }
        }

        function animateFallingLeaves() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (treeImage) ctx.drawImage(treeImage, treeOffsetX, 0);

            if (Math.random() < 0.2) fallingLeaves.push(new Leaf());

            fallingLeaves = fallingLeaves.filter(leaf => {
                const alive = leaf.update();
                if (alive) leaf.draw();
                return alive;
            });

            requestAnimationFrame(animateFallingLeaves);
        }

        const startX = canvas.width / 2;
        const startY = canvas.height + 20;
        drawBranch(startX, startY, 150, -Math.PI / 2, 26, 0, 0);
    </script>
</body>
</html>